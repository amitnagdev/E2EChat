'use strict';

/***********************************
 *** START ~ Module dependencies ***
 ***********************************/

// Global dependencies
const glob = require('glob'),
    chalk = require('chalk');

/***********************************
 *** END ~ Module dependencies ***
 ***********************************/

const setupEnvironment = () => {
    //if (process.env.NODE_ENV === 'dev' || process.env.NODE_ENV === 'test') {
    process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
    //}
};

/**
 * Module init function.
 */
module.exports = (settings) => {
    if (settings) {
        if (!process.env.NODE_ENV) {
            console.error(chalk.keyword('orange')('NODE_ENV is not defined! Using default development environment'));
            process.env.NODE_ENV = 'dev';
        }

        let env = process.env.NODE_ENV;

        /**
         * Before we begin, lets set the environment variable
         * We'll Look for a valid NODE_ENV variable and if one cannot be found load the dev NODE_ENV
         */
        let environmentFiles = glob.sync(settings.config.baseDir + env + '/' + env + '.js');
        if (!environmentFiles.length) {
            if (process.env.NODE_ENV) {
                console.error(chalk.keyword('orange')('No configuration file found for "' + process.env.NODE_ENV + '" environment using development instead'));
            } else {
                console.error(chalk.keyword('orange')('NODE_ENV is not defined! Using default development environment'));
            }

            process.env.NODE_ENV = 'dev';
            setupEnvironment();
        } else {
            setupEnvironment();
            console.log(chalk.green.bgWhite('Application loaded using the "' + process.env.NODE_ENV + '" environment configuration'));
        }
    }
};